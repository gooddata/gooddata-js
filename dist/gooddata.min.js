/* Copyright (C) 2007-2013, GoodData(R) Corporation. All rights reserved. */
/* gooddata - v0.0.12 */
/* 2014-03-13 15:37:57 */
/* Latest git commit: "99129eb" */

(function(window,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():window.gooddata=t()})(this,function(){var t,e;return function(){var r={},n={};t=function(t,e,n){r[t]={deps:e,callback:n}},e=function(t){function i(e){if("."!==e.charAt(0))return e;for(var r=e.split("/"),n=t.split("/").slice(0,-1),i=0,o=r.length;o>i;i++){var u=r[i];if(".."===u)n.pop();else{if("."===u)continue;n.push(u)}}return n.join("/")}if(n[t])return n[t];if(n[t]={},!r[t])throw Error("Could not find module "+t);for(var o,u=r[t],a=u.deps,c=u.callback,s=[],f=0,l=a.length;l>f;f++)"exports"===a[f]?s.push(o={}):s.push(e(i(a[f])));var d=c.apply(this,s);return n[t]=o||d},e.entries=r}(),t("loader",function(){}),t("_jquery",[],function(){if("undefined"==typeof $)throw Error("You need to include jQuery to use Gooddata JS");return window.$}),t("xhr",["_jquery"],function(t){var e,r,n={},i=function(t,e){n.ajax(t).done(function(t,r,n){e.resolve(t,r,n)}).fail(function(t,r,n){e.reject(t,r,n)})},o=function(t,r){e.done(function(){i(t,r)}).fail(function(t,e,n){401!==t.status&&r.reject(t,e,n)})},u=function(r,n){e||(e=t.ajax("/gdc/account/token/").always(function(){e=null}).fail(function(e,i,o){return 401===e.status&&t.isFunction(r.unauthorized)?(r.unauthorized(e),void 0):(n.reject(e,i,o),void 0)})),o(r,n)},a=function(t,e){setTimeout(function(){i(t,e)},t.pollDelay)},c=function(e,r,n){var i=e[r];delete e[r],t.isFunction(i)&&n(i),t.isArray(i)&&i.forEach(function(e){t.isFunction(i)&&n(e)})};n.ajaxSetup=function(e){r=t.extend({contentType:"application/json",dataType:"json",pollDelay:1e3},e)},n.ajax=function(n,i){t.isPlainObject(n)&&(i=n,n=void 0),i=t.extend({},r,i),n&&(i.url=n),t.isPlainObject(i.data)&&(i.data=JSON.stringify(i.data));var s=t.Deferred();return c(i,"success",s.done),c(i,"error",s.fail),c(i,"complete",s.always),e?(o(i,s),s):(t.ajax(i).fail(function(t,e,r){401===t.status?u(i,s):s.reject(t,e,r)}).done(function(t,e,r){202===r.status?a(i,s):s.resolve(t,e,r)}),s)};var s=function s(e){return function(r,i){var o=t.extend(!0,{method:e},i);return n.ajax(r,o)}};return n.get=s("GET"),n.post=s("POST"),n.put=s("PUT"),n.ajaxSetup({}),n}),t("sdk",["./xhr"],function(t){var e={reportDefinition:{content:{filters:[],format:"grid",grid:{rows:[],columns:[],sort:{columns:[],rows:[]},columnWidths:[],metrics:[]}},meta:{title:"Test",summary:"",tags:"",deprecated:0,category:"reportDefinition"}}},r=[{r:43,g:107,b:174},{r:105,g:170,b:81},{r:238,g:177,b:76},{r:213,g:60,b:56},{r:137,g:77,b:148},{r:115,g:115,b:115},{r:68,g:169,b:190},{r:150,g:189,b:95},{r:253,g:147,b:105},{r:225,g:93,b:134},{r:124,g:111,b:173},{r:165,g:165,b:165},{r:122,g:166,b:213},{r:130,g:208,b:141},{r:255,g:210,b:137},{r:241,g:132,b:128},{r:191,g:144,b:198},{r:191,g:191,b:191}],n=function(t){var r=t.filter(function(t){return"metric"===t.type}),n=t.filter(function(t){return"attribute"===t.type}),i=$.extend(!0,{},e),o=i.reportDefinition.content.grid;return o.metrics=r.map(function(t){return{uri:t.uri,alias:""}}),o.columns=n.map(function(t){return{attribute:{alias:"",totals:[[],[]],uri:t.uri}}}).concat(r.length?["metricGroup"]:[]),i},i=function(t,e){var r,n=e.split("."),i=t;for(r=0;n.length>r;++r){if(void 0===i[n[r]])return void 0;i=i[n[r]]}return i},o=function(t){return function(e){return i(e,t)}},u=function(){return $.getJSON("/gdc/account/token")},a=function(e,r){var n=$.Deferred();return t.post("/gdc/account/login",{data:JSON.stringify({postUserLogin:{login:e,password:r,remember:1,captcha:"",verifyCaptcha:""}})}).then(n.resolve,n.reject),n.promise()},c=function(){var e=$.Deferred();return u().then(function(){return t.get("/gdc/app/account/bootstrap").then(function(t){var e=t.bootstrapResource.accountSetting.links.self,r=e.match(/([^\/]+)\/?$/)[1];return r},e.reject)},e.resolve).then(function(e){return t.ajax("/gdc/account/login/"+e,{method:"delete"})}).then(e.resolve,e.reject),e.promise()},s=function(e){return t.get("/gdc/account/profile/"+e+"/projects").then(function(t){return t.projects.map(function(t){return t.project})})},f=function(e){return t.get("/gdc/md/"+e+"/query/datasets").then(o("query.entries"))},l=function(e){var n=$.Deferred();return t.get("/gdc/projects/"+e+"/styleSettings").then(function(t){n.resolve(t.styleSettings.chartPalette.map(function(t){return{r:t.fill.r,g:t.fill.g,b:t.fill.b}}))},function(t){200===t.status&&n.resolve(r),n.reject(t)}),n.promise()},d=function(e,r){var n=$.Deferred();return t.put("/gdc/projects/"+e+"/styleSettings",{data:{styleSettings:{chartPalette:r.map(function(t,e){return{guid:"guid"+e,fill:t}})}}}).then(n.resolve,n.reject),n.promise()},p=function(e,r){var n={execution:{columns:r}},i={isLoaded:!1},o=$.Deferred();return t.post("/gdc/internal/projects/"+e+"/experimental/executions",{data:JSON.stringify(n)},o.reject).then(function(e){return i.headers=e.executionResult.columns.map(function(t){return t.attributeDisplayForm?{type:"attrLabel",id:t.attributeDisplayForm.meta.identifier,uri:t.attributeDisplayForm.meta.uri,title:t.attributeDisplayForm.meta.title}:{type:"metric",id:t.metric.meta.identifier,title:t.metric.meta.title,format:t.metric.content.format}}),t.ajax(e.executionResult.tabularDataResult)},o.reject).then(function(t){i.rawData=t.tabularDataResult.values,i.isLoaded=!0,o.resolve(i)},o.reject),o.promise()},m=function(e){return t.get("/gdc/md/"+e+"/query/attributes").then(o("query.entries"))},g=function(e){return t.get("/gdc/md/"+e+"/query/dimensions").then(o("query.entries"))},h=function(e,r){var n=function(e,r){var n=r?"?type="+r:"";return t.get("/gdc/md/"+e+"/query/folders"+n).then(o("query.entries"))};switch(r){case"fact":case"metric":return n(e,r);case"attribute":return g(e);default:var i=$.Deferred();return $.when(n(e,"fact"),n(e,"metric"),g(e)).done(function(t,e,r){i.resolve({fact:t,metric:e,attribute:r})}),i.promise()}},v=function(t,e){var r=$.Deferred();return h(t,e).then(function(n){var i=function(t){var e=$.Deferred();return $.when.apply(this,t.map(x)).then(function(){var t=Array.prototype.slice.call(arguments).map(function(t){return t.metric});e.resolve(t)},e.reject),e.promise()},o=function(t,e){return t.map(function(t){return t[e]})},u=function(t){t.forEach(function(t){t.items.sort(function(t,e){return t.meta.title<e.meta.title?-1:t.meta.title>e.meta.title?1:0})}),t.sort(function(t,e){return t.title<e.title?-1:t.title>e.title?1:0})},a=o(n,"link"),c=o(n,"title");$.when.apply(this,a.map(x)).then(function(){var n=Array.prototype.slice.call(arguments);if("attribute"===e)m(t).then(function(t){var e=[];n.forEach(function(t){t.dimension.content.attributes.forEach(function(t){e.push(t.meta.uri)})});var i=t.filter(function(t){return-1===e.indexOf(t.link)}).map(function(t){return t.link});$.when.apply(this,i.map(x)).then(function(){var t=Array.prototype.slice.call(arguments).map(function(t){return t.attribute}),e=n.map(function(t){return{title:t.dimension.meta.title,items:t.dimension.content.attributes}});e.push({title:"Unsorted",items:t}),u(e),r.resolve(e)})});else if("metric"===e){var a=n.map(function(t){return o(t.folder.content.entries,"link")});y(t).then(function(t){var e=[];n.forEach(function(t){t.folder.content.entries.forEach(function(t){e.push(t.link)})});var o=t.filter(function(t){return-1===e.indexOf(t.link)}).map(function(t){return t.link});a.push(o),$.when.apply(this,a.map(function(t){return i(t)})).then(function(){var t=Array.prototype.slice.call(arguments),e=t.map(function(t,e){return{title:c[e]||"Unsorted",items:t}});u(e),r.resolve(e)},r.reject)})}else r.reject()})},r.reject),r.promise()},y=function(e){return t.get("/gdc/md/"+e+"/query/metrics").then(o("query.entries"))},b=function(e,r){var n=$.Deferred();return t.post("/gdc/md/"+e+"/availablemetrics",{data:JSON.stringify(r)}).then(function(t){n.resolve(t.entries)},n.reject),n.promise()},j=function(e,r){var n=$.Deferred();return t.post("/gdc/md/"+e+"/drillcrosspaths",{data:JSON.stringify(r)}).then(function(t){n.resolve(t.drillcrosspath.links)},n.reject),n.promise()},D=function(){return t.get("/gdc/app/account/bootstrap").then(function(t){return t.bootstrapResource.current.project.links.self.split("/").pop()})},x=function(e){var r=$.Deferred();return t.get(e,{headers:{Accept:"application/json"},dataType:"json",contentType:"application/json"}).then(function(t){r.resolve(t)},r.reject),r.promise()},w=function(t){var e,r=$.Deferred(),n=function(t){if(t.attribute)return t.attribute.content.displayForms[0].meta.identifier;if(t.dimension)return t.dimension.content.attributes.content.displayForms[0].meta.identifier;if(t.metric)return t.metric.meta.identifier;throw"Unknown object!"};return $.isPlainObject(t)?r.resolve(n(e)):x(t).then(function(t){r.resolve(n(t))},r.reject),r.promise()},k=function(e,r){var n=$.Deferred(),i=function(t){var e=t.attribute?t.attribute:t.metric;return e.meta.uri};return t.ajax("/gdc/md/"+e+"/identifiers",{type:"POST",headers:{Accept:"application/json"},data:{identifierToUri:[r]}}).then(function(t){var e=t.identifiers.filter(function(t){return t.identifier===r});return e[0]?x(e[0].uri):(n.reject("identifier not found"),void 0)},n.reject).then(function(t){return t.attributeDisplayForm?x(t.attributeDisplayForm.content.formOf).then(function(t){n.resolve(i(t))},n.reject):n.resolve(i(t))},n.reject),n.promise()};return{DEFAULT_PALETTE:r,isLoggedIn:u,login:a,logout:c,getProjects:s,getDatasets:f,getColorPalette:l,setColorPalette:d,getData:p,getAttributes:m,getFolders:h,getFoldersWithItems:v,getDimensions:g,getMetrics:y,getAvailableMetrics:b,getAvailableAttributes:j,getReportDefinition:n,getCurrentProjectId:D,getObjectDetails:x,getObjectIdentifier:w,getObjectUri:k}}),t("gooddata",["xhr","sdk"],function(t,e){return e.xhr=t,e}),e("gooddata")});